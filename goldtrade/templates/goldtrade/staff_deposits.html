{% extends "base.html" %}
{% load humanize %}

{% block content %}
<h3 class="text-light fw-bold mb-4">üõ°Ô∏è Staff ‚Äì Bank Deposit Verification</h3>

<form method="GET" class="row g-2 mb-3">
  <div class="col-md-4">
    <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Search reference / user">
  </div>

  <div class="col-md-3">
    <select name="status" class="form-select">
      <option value="">All statuses</option>
      <option value="pending" {% if status == 'pending' %}selected{% endif %}>Pending</option>
      <option value="approved" {% if status == 'approved' %}selected{% endif %}>Approved</option>
      <option value="rejected" {% if status == 'rejected' %}selected{% endif %}>Rejected</option>
    </select>
  </div>

  <div class="col-md-3">
    <button class="btn btn-warning w-100">Filter</button>
  </div>
</form>

<div class="card" style="background:#10192c;border:1px solid #d4af37;">
  <div class="card-body">

    {% if deposits %}
      <table class="table text-light table-hover align-middle">
        <thead>
          <tr class="text-warning">
            <th>User</th>
            <th>Amount (LKR)</th>
            <th>Reference</th>
            <th>Status</th>
            <th>Slip</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
        {% for d in deposits %}
          <tr>
            <td>{{ d.user.username|title }}</td>
            <td>Rs. {{ d.amount|floatformat:2|intcomma }}</td>
            <td>{{ d.reference_no }}</td>

            <td>
              {% if d.status == 'pending' %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% elif d.status == 'approved' %}
                <span class="badge bg-success">Approved</span>
              {% else %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </td>

            <td>
              {% if d.slip %}
                <a href="{{ d.slip.url }}" target="_blank" class="btn btn-sm btn-outline-info">
                  View Slip
                </a>
              {% else %}
                -
              {% endif %}
            </td>

            <td>
              {% if d.status == 'pending' %}
                <a href="{% url 'approve_deposit' d.id %}" class="btn btn-sm btn-success">Approve ‚úÖ</a>
                <a href="{% url 'reject_deposit' d.id %}" class="btn btn-sm btn-danger">Reject ‚ùå</a>
              {% else %}
                <span class="text-muted small">Completed</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-center text-secondary">No deposits found.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
